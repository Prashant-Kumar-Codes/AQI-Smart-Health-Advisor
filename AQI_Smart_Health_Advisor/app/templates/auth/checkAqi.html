{% extends 'base.html' %}
{% block title %}AQI Status - Real-time Air Quality Index{% endblock %}

{% block style %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/checkAqi.css') }}" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
    <!-- Navigation Bar -->
    <nav class="aqi-navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="brand-icon">ğŸŒ</span>
                <span class="brand-text">AQI Status</span>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('home_auth.aqi_homepage') }}" class="nav-link">Home</a>
                <a href="{{ url_for('checkAqi_auth.check_aqi') }}" class="nav-link active">AQI Status</a>
                <a href="{{ url_for('ai_advisor_auth.ai_advisor') }}" class="nav-link">AI Advisor</a>
                <a href="{{ url_for('live_track_auth.live_track') }}" class="nav-link">Live Tracker</a>
                <a href="{{ url_for('about_auth.about') }}" class="nav-link">About</a>
                <a href="{{ url_for('learnMore_auth.learnMoreAqi') }}" class="nav-link">AQI Guide</a>
                <a href="{{ url_for('login_auth.login_signup_page') }}" class="nav-link">Login</a>
            </div>
        </div>
    </nav>

    <!-- Animated Air Flow Background -->
    <div class="air-flow-container">
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
        <div class="air-particle"></div>
    </div>

    <div class="container">
        <!-- Professional Header Section -->
        <div class="header-professional">
            <div class="header-content-pro">
                <h1 class="main-title">Air Quality Monitoring System</h1>
                <p class="main-subtitle">Real-time environmental data with AI-powered health insights</p>
                <div class="header-features">
                    <div class="feature-badge">
                        <span class="feature-icon">ğŸŒ</span>
                        <div class="feature-info">
                            <div class="feature-label">Coverage</div>
                            <div class="feature-value">Global</div>
                        </div>
                    </div>
                    <div class="feature-badge">
                        <span class="feature-icon">âš¡</span>
                        <div class="feature-info">
                            <div class="feature-label">Updates</div>
                            <div class="feature-value">Real-time</div>
                        </div>
                    </div>
                    <div class="feature-badge">
                        <span class="feature-icon">ğŸ¤–</span>
                        <div class="feature-info">
                            <div class="feature-label">AI Powered</div>
                            <div class="feature-value">GPT-4</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Professional Search Section -->
        <div class="search-section-pro">
            <div class="search-header">
                <h2 class="search-title">Location Search</h2>
                <p class="search-subtitle">Enter your location or use the map to check air quality</p>
            </div>
            
            <div class="search-controls">
                <div class="input-group-pro">
                    <span class="input-icon">ğŸ“</span>
                    <input 
                        type="text" 
                        id="locationInput" 
                        class="input-pro"
                        placeholder="Enter city, address, or coordinates"
                        autocomplete="off"
                    >
                </div>
                <div class="button-group">
                    <button class="btn-pro btn-primary-pro" onclick="searchAQI()">
                        <span class="btn-icon-pro">ğŸ”</span>
                        <span>Search</span>
                    </button>
                    <button class="btn-pro btn-secondary-pro" onclick="getCurrentLocation()">
                        <span class="btn-icon-pro">ğŸ“</span>
                        <span>Current Location</span>
                    </button>
                    <button class="btn-pro btn-map-pro" onclick="openMapSelector()">
                        <span class="btn-icon-pro">ğŸ—ºï¸</span>
                        <span>Select on Map</span>
                    </button>
                    
                    <a href="{{url_for('live_track_auth.live_track')}}">
                    <button class="btn-pro btn-live-tracking-pro">
                        <span class="btn-icon-pro">ğŸ—ºï¸</span>
                        <span>Live Tracking</span>
                    </button></a>

                </div>
            </div>

            <!-- Quick Access Cities -->
            <div class="quick-access">
                <span class="quick-label">Quick Access:</span>
                <div class="city-chips">
                    <button class="city-chip" onclick="quickSearch('Delhi')">ğŸ‡®ğŸ‡³ Delhi</button>
                    <button class="city-chip" onclick="quickSearch('Mumbai')">ğŸ‡®ğŸ‡³ Mumbai</button>
                    <button class="city-chip" onclick="quickSearch('Beijing')">ğŸ‡¨ğŸ‡³ Beijing</button>
                    <button class="city-chip" onclick="quickSearch('London')">ğŸ‡¬ğŸ‡§ London</button>
                    <button class="city-chip" onclick="quickSearch('New York')">ğŸ‡ºğŸ‡¸ New York</button>
                    <button class="city-chip" onclick="quickSearch('Tokyo')">ğŸ‡¯ğŸ‡µ Tokyo</button>
                </div>
            </div>

            <!-- Nearest Location Alert -->
            <div class="nearest-alert" id="nearestAlert" style="display: none;">
                <div class="alert-icon">â„¹ï¸</div>
                <div class="alert-text">
                    <strong>Showing nearest monitoring station:</strong>
                    <span id="nearestStationInfo"></span>
                    <div id="distanceInfo" style="margin-top: 8px; font-weight: 600;"></div>
                </div>
            </div>

            <!-- Alternative Stations -->
            <div class="alternative-stations" id="alternativeStations" style="display: none;">
                <p style="font-weight: 600; margin-bottom: 10px; color: #1f2937;">
                    ğŸ“ Other nearby monitoring stations:
                </p>
                <div id="alternativeStationsList"></div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Fetching air quality data...</p>
            </div>

            <!-- Error State -->
            <div class="error" id="error"></div>
        </div>

        <!-- Map Overlay -->
        <div class="map-overlay" id="mapOverlay" style="display: none;">
            <div class="map-container-overlay">
                <div class="map-header">
                    <h3>Select Location on Map</h3>
                    <button class="map-close-btn" onclick="closeMapSelector()">âœ•</button>
                </div>
                <div id="mapSelector" class="map-selector"></div>
                <div class="map-footer">
                    <p id="mapCoordinates">Click on the map to select a location</p>
                    <button class="btn-pro btn-primary-pro" id="confirmLocationBtn" onclick="confirmMapLocation()" disabled>
                        Confirm Location
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
            <div class="aqi-card-pro">
                <!-- AQI Header -->
                <div class="aqi-header-pro">
                    <div class="location-info-pro">
                        <h2 id="cityName">-</h2>
                        <p id="updateTime" class="update-time-pro">
                            <span class="time-icon">ğŸ•’</span>
                            <span id="updateTimeText">-</span>
                        </p>
                    </div>
                    <div class="aqi-display-pro" id="aqiDisplay">
                        <div class="aqi-badge-pro">
                            <div class="aqi-value-pro" id="aqiValue">-</div>
                            <div class="aqi-label-pro">AQI</div>
                        </div>
                        <div class="aqi-category-pro" id="aqiCategory">-</div>
                    </div>
                </div>

                <!-- Weather Information -->
                <div class="info-section-pro">
                    <h3 class="subsection-title-pro">
                        <span class="title-icon">ğŸŒ¡ï¸</span>
                        Weather Conditions
                    </h3>
                    <div class="weather-info-pro" id="weatherInfo"></div>
                </div>

                <!-- Air Pollutants -->
                <div class="info-section-pro">
                    <h3 class="subsection-title-pro">
                        <span class="title-icon">âš—ï¸</span>
                        Air Pollutants
                    </h3>
                    <div class="pollutants-grid-pro" id="pollutantsGrid"></div>
                </div>

                <!-- Dominant Pollutant Info -->
                <div class="dominant-pollutant-card-pro" id="dominantPollutantCard">
                    <div class="info-icon">âš ï¸</div>
                    <p id="dominantPollutant"></p>
                </div>
            </div>

            <!-- AI Health Recommendations Card -->
            <div class="recommendations-card-pro">
                <div class="recommendations-header">
                    <h3 class="recommendations-title-pro">
                        <span class="title-icon">ğŸ¤–</span>
                        AI-Powered Health Recommendations
                    </h3>
                    <a href="{{url_for('ai_advisor_auth.ai_advisor')}}" style="text-decoration: none;"><button class="btn-more-insights" onclick="openAIAdvisor()">
                        âœ¨ More AI Insights
                    </button></a>
                </div>
                
                <!-- Custom AI Recommendation Section -->
                <div class="ai-recommendation-box-pro" id="aiRecommendationBox">
                    <div class="ai-badge-pro">
                        <span class="ai-icon">âœ¨</span>
                        <span>Personalized Insight</span>
                    </div>
                    <p id="customRecommendation" class="custom-recommendation-pro">
                        Loading personalized recommendations...
                    </p>
                </div>
                            <!-- Personalized AI Insights Card -->
            <div class="personalized-ai-card-pro" id="personalizedAiCard" style="display: none;">
                <div class="ai-insights-header">
                    <h3 class="ai-insights-title">
                        <span class="title-icon">ğŸ¯</span>
                        Your Personalized AI Insights
                    </h3>
                    <button class="btn-customize-insights" onclick="openAIAdvisor()">
                        âš™ï¸ Customize
                    </button>
                </div>
                
                <div class="ai-insights-content">
                    <div class="insight-section" id="personalizedInsightContent">

                        <!-- AI response will be injected here -->
                    </div>
                    
                    <div class="insight-metadata">
                        <span class="metadata-item">ğŸ“ <span id="insightLocation">-</span></span>
                        <span class="metadata-item">ğŸ‘¤ <span id="insightProfile">-</span></span>
                    </div>
                </div>
                
                <button class="btn-refresh-insights" onclick="refreshPersonalizedInsights()">
                    ğŸ”„ Update Insights
                </button>
            </div>

                <div class="recommendations-pro" id="recommendations"></div>
            </div>



            <!-- Health Impact & Take Action Side by Side -->
            <div class="action-cards-container">
                <!-- Health Impact Card -->
                <div class="expandable-card-pro health-impact-card">
                    <div class="expandable-header-pro" onclick="toggleCard('healthImpactCard')">
                        <div class="expandable-title-pro">
                            <div class="info-card-icon">ğŸ¥</div>
                            <h4>Health Impact</h4>
                        </div>
                        <span class="expand-icon-pro">â–¼</span>
                    </div>
                    <div class="expandable-content-pro" id="healthImpactCard">
                        <div class="expandable-inner-pro">
                            <p><strong>Who is at Risk?</strong></p>
                            <ul class="impact-list-pro">
                                <li><strong>ğŸ‘¶ Children:</strong> Developing lungs, breathe more air per body weight</li>
                                <li><strong>ğŸ‘´ Elderly:</strong> Susceptible to particle pollution effects</li>
                                <li><strong>ğŸ« Respiratory Conditions:</strong> Asthma, COPD patients highly sensitive</li>
                                <li><strong>â¤ï¸ Heart Conditions:</strong> Risk of heart attacks and arrhythmias</li>
                                <li><strong>ğŸƒ Active Outdoors:</strong> Athletes breathe more polluted air</li>
                            </ul>
                            
                            <p style="margin-top: 15px;"><strong>Short-term Effects:</strong></p>
                            <p>Eye, nose, throat irritation, coughing, chest tightness, shortness of breath, reduced lung function.</p>
                            
                            <p style="margin-top: 15px;"><strong>Long-term Effects:</strong></p>
                            <p>Chronic exposure can lead to reduced lung function, respiratory diseases, cardiovascular problems, and increased cancer risk.</p>
                        </div>
                    </div>
                </div>

                <!-- Take Action Card -->
                <div class="expandable-card-pro take-action-card">
                    <div class="expandable-header-pro" onclick="toggleCard('takeActionCard')">
                        <div class="expandable-title-pro">
                            <div class="info-card-icon">ğŸŒ±</div>
                            <h4>Take Action</h4>
                        </div>
                        <span class="expand-icon-pro">â–¼</span>
                    </div>
                    <div class="expandable-content-pro" id="takeActionCard">
                        <div class="expandable-inner-pro">
                            <p><strong>Individual Actions:</strong></p>
                            <ul class="action-list-pro">
                                <li>ğŸšŒ Use public transportation, carpool, or bike</li>
                                <li>ğŸ’¡ Conserve energy at home</li>
                                <li>ğŸŒ¡ï¸ Use energy-efficient settings</li>
                                <li>ğŸš— Maintain vehicle properly</li>
                                <li>ğŸ”¥ Avoid burning wood or trash</li>
                                <li>ğŸŒ³ Plant trees and support green spaces</li>
                                <li>â™»ï¸ Reduce, reuse, and recycle</li>
                            </ul>
                            
                            <p style="margin-top: 15px;"><strong>Protect Yourself:</strong></p>
                            <ul class="action-list-pro">
                                <li>ğŸ“± Monitor air quality regularly</li>
                                <li>ğŸ˜· Keep N95/KN95 masks available</li>
                                <li>ğŸ’¨ Use HEPA air purifiers at home</li>
                                <li>ğŸƒ Plan outdoor activities wisely</li>
                                <li>ğŸªŸ Keep windows closed on bad days</li>
                                <li>ğŸ’Š Keep medications updated</li>
                            </ul>
                            
                            <p style="margin-top: 15px;"><strong>Community Action:</strong></p>
                            <p>Support clean air initiatives, advocate for stricter emissions, participate in tree-planting, and encourage workplace air quality measures.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attribution -->
        <div class="attribution-pro">
            <p>Data provided by <a href="https://aqicn.org" target="_blank">World Air Quality Index Project</a> & <a href="https://openweathermap.org" target="_blank">OpenWeather</a></p>
            <p class="attribution-note-pro">Real-time data from global monitoring stations</p>
        </div>
    </div>

{% block script %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/checkAqi.js') }}"></script>
    <script>
    // Auto-fill user's city on page load
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('/api/user/city');
            if (response.ok) {
                const data = await response.json();
                if (data.city) {
                    document.getElementById('locationInput').value = data.city;
                    document.getElementById('aiAdvisorLocation').value = data.city;
                }
            }
        } catch (error) {
            console.log('User not logged in or error fetching city');
        }
    });
    </script>
{% endblock %}

{% endblock %}
